# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               github 1.0

name                    pinentry-mac
github.setup            GPGTools pinentry 1.1.1.1 v
revision                0

categories              aqua security
license                 GPL-3+
maintainers             {ionic @Ionic}
platforms               macosx

description             Cocoa interface for the password entry software pinentry.
long_description        ${description} \
                        It is based on the upstream version of pinentry, adding a \
                        custom interface based on Cocoa for OS X look and feel.

checksums               rmd160 020b63bea209a86435b84379995b3070626627a1 \
                        sha256 8aabf9e04996a88f93d71546e68165bc169e062679348135bf1ba9e95355a9a7 \
                        size   714831

# Utilizes ARC which is x86_64/arm64-only. #45949
supported_archs         x86_64 arm64
installs_libs           no

depends_build           port:autoconf \
                        port:automake \
                        port:libtool

depends_lib             port:libassuan

pre-fetch {
    if {${os.major} < 12} {
        ui_error    "This package is only compatible with Xcode 5 and up.
                     Xcode 5 and up is not compatible with 10.7 and below."
        error       "Unsupported operating system."
    }
}

use_autoreconf          yes
autoreconf.args         -fiv
configure.args          --disable-ncurses --enable-maintainer-mode
use_xcode               yes

destroot {
    copy ${worksrcpath}/macosx/pinentry-mac.app ${destroot}${applications_dir}/${name}.app
}

notes "
    If you previously didn't have pinentry or gpg-agent installed \
    and ${name} has been installed as a dependency of gpg-agent, \
    you don't need to do anything to use ${name}.

    If you want to switch to the GTK2, ncurses or Qt4 based pinentry \
    program, please install pinentry with the correct use flags and \
    follow the instructions below substituting the ${name} program \
    path with ${prefix}/bin/pinentry.


    If you previously had pinentry and gpg-agent installed and would \
    like to switch to ${name}, you will have to set \
    it as your pinentry program in \$HOME/.gnupg/gpg-agent.conf.

    Add the following line to the mentioned file:
    pinentry-program ${applications_dir}/${name}.app/Contents/MacOS/${name}


    Be sure to comment previous \"pinentry-program\" lines, for example:

    pinentry-program SAMPLE

    becomes

    #pinentry-program SAMPLE


    Afterwards, run
    killall -HUP gpg-agent

    or simply log out and back in again.
"
